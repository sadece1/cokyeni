[unix_http_server]
file=/var/run/supervisor/supervisord.sock
chmod=0700

[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisor/supervisord.pid
socket=/var/run/supervisor/supervisord.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor/supervisord.sock

# Alternative: Also create symlink for compatibility
# RUN ln -sf /var/run/supervisor/supervisord.sock /run/supervisord.sock

[program:nginx]
command=/bin/sh -c "nginx -t && nginx -g 'daemon off;' -c /etc/nginx/nginx.conf"
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/nginx.err.log
stdout_logfile=/var/log/supervisor/nginx.out.log
priority=10
startsecs=3
startretries=3

[program:nodejs]
command=/bin/sh -c "cd /app && node dist/server.js"
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/nodejs.err.log
stdout_logfile=/var/log/supervisor/nodejs.out.log
priority=20
user=nodejs
environment=NODE_ENV="production"
startsecs=10
startretries=3
stopwaitsecs=10

